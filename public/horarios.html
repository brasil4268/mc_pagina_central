<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão de Horários - EduGest</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    
    <style>
        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .dia-header {
            background: var(--background-gradient);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .dia-coluna {
            background: white;
            min-height: 300px;
            padding: 10px;
        }
        
        .horario-item {
            background: #f8fafc;
            border-left: 4px solid var(--secondary-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .horario-item:hover {
            background: #e2e8f0;
            transform: translateX(3px);
        }
        
        .horario-curso {
            font-weight: 600;
            color: var(--primary-color);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .horario-periodo {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.8rem;
            color: #666;
        }
        
        .periodo-tag {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
        }
        
        .periodo-manha {
            background: #fef3c7;
            color: #92400e;
        }
        
        .periodo-tarde {
            background: #fed7aa;
            color: #9a3412;
        }
        
        .periodo-noite {
            background: #ddd6fe;
            color: #5b21b6;
        }
        
        .horario-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .horario-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .horario-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .dia-badge {
            background: var(--background-gradient);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .view-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .view-btn.active {
            background: var(--primary-color);
            color: white;
        }
        
        .view-btn:hover {
            background: var(--primary-color);
            color: white;
        }
        
        @media (max-width: 768px) {
            .calendario-grid {
                grid-template-columns: 1fr;
            }
            
            .dia-header {
                display: none;
            }
            
            .dia-coluna {
                border-top: 3px solid var(--primary-color);
                position: relative;
            }
            
            .dia-coluna::before {
                content: attr(data-dia);
                position: absolute;
                top: -25px;
                left: 0;
                font-weight: 600;
                color: var(--primary-color);
                background: white;
                padding: 5px 10px;
                border-radius: 5px 5px 0 0;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html" class="logo">
            <i class="fas fa-graduation-cap"></i>
            <span>EduGest</span>
        </a>
        
        <div class="nav-links">
            <a href="index.html" class="nav-link">
                <i class="fas fa-home"></i>
                Início
            </a>
            <a href="centros.html" class="nav-link">
                <i class="fas fa-building"></i>
                Centros
            </a>
            <a href="cursos.html" class="nav-link">
                <i class="fas fa-book"></i>
                Cursos
            </a>
            <a href="formadores.html" class="nav-link">
                <i class="fas fa-chalkboard-teacher"></i>
                Formadores
            </a>
            <a href="horarios.html" class="nav-link active">
                <i class="fas fa-clock"></i>
                Horários
            </a>
            <a href="dashboard.html" class="nav-link">
                <i class="fas fa-chart-dashboard"></i>
                Dashboard
            </a>
            <button id="theme-toggle" class="btn btn-outline btn-sm">
                <i class="fas fa-moon"></i>
            </button>
            <button class="btn btn-danger btn-sm" onclick="logout()" id="logout-btn" style="display: none;">
                <i class="fas fa-sign-out-alt"></i>
                Sair
            </button>
        </div>
    </nav>

    <div class="container">
        <!-- Header -->
        <div class="card mb-3">
            <div class="card-header">
                <div class="card-title">
                    <div class="card-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    Gestão de Horários
                </div>
            </div>
            <p style="color: #666; margin: 0;">
                Organize os horários dos cursos por dia da semana e período
            </p>
        </div>

        <!-- Estatísticas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-horarios">0</div>
                <div class="stat-label">Total de Horários</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="horarios-manha">0</div>
                <div class="stat-label">Manhã</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="horarios-tarde">0</div>
                <div class="stat-label">Tarde</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="horarios-noite">0</div>
                <div class="stat-label">Noite</div>
            </div>
        </div>

        <!-- Controles e Filtros -->
        <div class="filter-section">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 20px;">
                <div>
                    <h3 style="color: var(--primary-color); margin-bottom: 5px;">
                        <i class="fas fa-filter"></i> Visualização e Filtros
                    </h3>
                    <p style="color: #666; margin: 0;">Escolha como visualizar os horários</p>
                </div>
                
                <button class="btn btn-primary" onclick="abrirModalHorario()" id="btn-novo-horario">
                    <i class="fas fa-plus"></i> Novo Horário
                </button>
            </div>
            
            <div class="view-toggle">
                <button class="view-btn active" onclick="alterarVisualizacao('calendario')" id="btn-calendario">
                    <i class="fas fa-calendar"></i> Calendário
                </button>
                <button class="view-btn" onclick="alterarVisualizacao('lista')" id="btn-lista">
                    <i class="fas fa-list"></i> Lista
                </button>
            </div>
            
            <div class="filter-grid">
                <div class="form-group">
                    <label class="form-label">Buscar curso</label>
                    <div class="input-group">
                        <input type="text" id="busca-horario" class="form-control" placeholder="Nome do curso...">
                        <i class="fas fa-search input-group-icon"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dia da Semana</label>
                    <select id="filtro-dia" class="form-control">
                        <option value="">Todos os dias</option>
                        <option value="segunda">Segunda-feira</option>
                        <option value="terca">Terça-feira</option>
                        <option value="quarta">Quarta-feira</option>
                        <option value="quinta">Quinta-feira</option>
                        <option value="sexta">Sexta-feira</option>
                        <option value="sabado">Sábado</option>
                        <option value="domingo">Domingo</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Período</label>
                    <select id="filtro-periodo" class="form-control">
                        <option value="">Todos os períodos</option>
                        <option value="manha">Manhã</option>
                        <option value="tarde">Tarde</option>
                        <option value="noite">Noite</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button class="btn btn-secondary w-100" onclick="limparFiltros()" style="margin-top: 25px;">
                        <i class="fas fa-times"></i> Limpar Filtros
                    </button>
                </div>
            </div>
        </div>

        <!-- Visualização em Calendário -->
        <div id="view-calendario">
            <div class="calendario-grid">
                <div class="dia-header">Segunda</div>
                <div class="dia-header">Terça</div>
                <div class="dia-header">Quarta</div>
                <div class="dia-header">Quinta</div>
                <div class="dia-header">Sexta</div>
                <div class="dia-header">Sábado</div>
                <div class="dia-header">Domingo</div>
                
                <div class="dia-coluna" data-dia="Segunda" id="dia-segunda"></div>
                <div class="dia-coluna" data-dia="Terça" id="dia-terca"></div>
                <div class="dia-coluna" data-dia="Quarta" id="dia-quarta"></div>
                <div class="dia-coluna" data-dia="Quinta" id="dia-quinta"></div>
                <div class="dia-coluna" data-dia="Sexta" id="dia-sexta"></div>
                <div class="dia-coluna" data-dia="Sábado" id="dia-sabado"></div>
                <div class="dia-coluna" data-dia="Domingo" id="dia-domingo"></div>
            </div>
        </div>

        <!-- Visualização em Lista -->
        <div id="view-lista" style="display: none;">
            <div id="horarios-lista-container">
                <!-- Os horários em lista serão carregados aqui -->
            </div>
        </div>

        <!-- Estado vazio -->
        <div id="empty-state" class="empty-state" style="display: none;">
            <i class="fas fa-clock"></i>
            <h3>Nenhum horário encontrado</h3>
            <p>Não há horários cadastrados ou que correspondam aos filtros aplicados.</p>
            <button class="btn btn-primary" onclick="abrirModalHorario()">
                <i class="fas fa-plus"></i> Cadastrar Primeiro Horário
            </button>
        </div>
    </div>

    <!-- Modal Horário -->
    <div id="modal-horario" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title" id="modal-horario-title">
                    <i class="fas fa-clock"></i>
                    Novo Horário
                </h2>
                <button class="modal-close" onclick="fecharModalHorario()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div id="alert-container-horario"></div>
                
                <form id="form-horario" class="ajax-form">
                    <div class="form-group">
                        <label class="form-label" for="horario-curso-id">Curso *</label>
                        <select id="horario-curso-id" name="curso_id" class="form-control" required>
                            <option value="">Selecione um curso</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="horario-dia-semana">Dia da Semana *</label>
                        <select id="horario-dia-semana" name="dia_semana" class="form-control" required>
                            <option value="">Selecione o dia</option>
                            <option value="segunda">Segunda-feira</option>
                            <option value="terca">Terça-feira</option>
                            <option value="quarta">Quarta-feira</option>
                            <option value="quinta">Quinta-feira</option>
                            <option value="sexta">Sexta-feira</option>
                            <option value="sabado">Sábado</option>
                            <option value="domingo">Domingo</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="horario-periodo">Período *</label>
                        <select id="horario-periodo" name="periodo" class="form-control" required>
                            <option value="">Selecione o período</option>
                            <option value="manha">Manhã</option>
                            <option value="tarde">Tarde</option>
                            <option value="noite">Noite</option>
                        </select>
                        <div class="invalid-feedback"></div>
                    </div>
                    
                    <div class="flex-between mt-3">
                        <button type="button" class="btn btn-secondary" onclick="fecharModalHorario()">
                            <i class="fas fa-times"></i> Cancelar
                        </button>
                        <button type="submit" class="btn btn-success" id="btn-salvar-horario">
                            <i class="fas fa-save"></i> Salvar Horário
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Confirmação Delete -->
    <div id="modal-delete-horario" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">
                    <i class="fas fa-exclamation-triangle"></i>
                    Confirmar Exclusão
                </h2>
                <button class="modal-close" onclick="fecharModalDeleteHorario()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="text-center mb-2">
                    <i class="fas fa-trash-alt" style="font-size: 3rem; color: var(--danger-color); opacity: 0.7;"></i>
                </div>
                
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    Esta ação é irreversível! O horário será removido permanentemente.
                </div>
                
                <div style="background: #f8fafc; border-radius: 10px; padding: 15px; margin-bottom: 25px;">
                    <h4 style="color: var(--primary-color); margin-bottom: 10px;">
                        <i class="fas fa-clock"></i> Horário a ser excluído:
                    </h4>
                    <div id="delete-horario-info"></div>
                </div>
                
                <div class="flex-between">
                    <button type="button" class="btn btn-secondary" onclick="fecharModalDeleteHorario()">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-danger" id="btn-confirmar-delete-horario">
                        <i class="fas fa-trash"></i> Excluir Horário
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/app.js"></script>
    <script src="js/horarios.js"></script>
    <script>
        // Variáveis globais
        let horarios = [];
        let cursos = [];
        let horarioEdicao = null;
        let horarioDelete = null;
        let visualizacaoAtual = 'calendario';

        const diasSemana = {
            'segunda': 'Segunda-feira',
            'terca': 'Terça-feira', 
            'quarta': 'Quarta-feira',
            'quinta': 'Quinta-feira',
            'sexta': 'Sexta-feira',
            'sabado': 'Sábado',
            'domingo': 'Domingo'
        };

        // Verificar permissões
        function verificarPermissoes() {
            const user = app.currentUser;
            const isAdmin = user && user.role === 'admin';
            
            document.getElementById('btn-novo-horario').style.display = isAdmin ? 'inline-flex' : 'none';
            document.getElementById('logout-btn').style.display = user ? 'inline-flex' : 'none';
            
            if (!isAdmin) {
                window.location.href = 'usuario.html';
            }
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            verificarPermissoes();
            carregarDados();
            configurarFiltros();
        });

        // Carregar dados
        async function carregarDados() {
            try {
                const [horariosData, cursosData] = await Promise.all([
                    app.makeRequest(`${APP_CONFIG.API_BASE}/horarios`),
                    app.makeRequest(`${APP_CONFIG.API_BASE}/cursos`)
                ]);
                
                horarios = horariosData;
                cursos = cursosData;
                
                atualizarEstatisticas();
                aplicarFiltros();
                preencherSelectCursos();
                
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
                app.showAlert('danger', error.message || 'Erro ao carregar dados');
                document.getElementById('empty-state').style.display = 'block';
            }
        }

        // Continua no próximo arquivo...
        window.loadData = carregarDados;
        
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                app.logout();
            }
        }
    </script>
</body>
</html>
